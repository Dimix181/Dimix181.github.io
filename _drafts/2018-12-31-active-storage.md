---
layout: post
title:  "Working With Rails Active Storage"
categories: RAILS
tags: ruby rails active storage
---

### [Rails Active Storage](https://edgeguides.rubyonrails.org/active_storage_overview.html)
Rails inctroduce active storage very recently has of the writing of this post.
Active storage allows users to upload files to their cloud service of choice.
Although there always been diffent methods of implementing this feature such as [paperclip](https://github.com/thoughtbot/paperclip)
its a more holistic approch since its a baked into the rails framework already. Active storage does require an external gem  such as MiniMagick in order to perform transformations on any image attachment. 

The requirement of two additional table is required in order to intergrate Active Storage into your Rails applicaiton. These tables are `active_storage_blobs` and `active_storage_attachments`. After either installing or upgrading to an Active Record supported version of Rails (5.2 or higher) the required tables generated by creating Rails by creating a migration file with `rails active_storage:install` command and `rails db:migrate` to execute the migration.

The attachments that are used by your Rails application need to be store some where. Rails facilitates the configurations of these services by providing a space within your application to define them. In `config/storage.yml` is where these services get define. By default local storage used. Some services do require additional gems to work. Make such to keep an eye out for that. Although for production a storage service such as Amazon, Google, Azures is recommended since storage can get expensive within time.
Now that the services are define its time to tell Rails which service to use. `config/environments/development.rb`

Attaching files its very straight forward once we get all the requirements in order. First we set the proper associations.
Active Storage supports `has_one`, `has_many` and many more by adding the suffix `attached` to the association such as `has_one_attached`.
These associaitons allows for images to be atached to the object identified in the association by call `attach `. Other methods can be called such as `attached?` to determined if an object have many attachments, `detach` to delete the attachment but leaving its reference, while `purge` completely removes the attachment alone with its blob. You also have access to `purge_later` to remove the attachment through a queing system.

Other CRUD functions are available to performed on any attachment. Calling `attach` to an object with an attachment will add new images to the object if the object association is declared as `has_many_attached`.

There will be times where you would want to link an attachment on your page. Active Storage makes the process of linking attachments very straight forward. To generate a download link one would call `rails_blob_path(atttachment_name, disposition: "attachment")`

Transforming attachments requires the use of third party gems such as `mini_magick`. Mini Magick allows for certain files such as pdfs to be preview and images to be resized and transform.  Calling `variant(resize:"sizexsize")` to the attachment will resize it while calling `preview(resize:"sizexsize")` will preview the attachment if possible. When preview videos Active Storage uses the first frame for the preview.

Active Storage also allows for direct uploads transfering any attachment from the client directly to cloud services.
In order to activate this feature Rails asset pipeline must be setup correctly by including `activestorage.js` in your application bundle.
Once its enable using either npm or via Rails asset pipeline `direct_upload: true` is passed from the view to allow direct upload.
Direct upload is intergratable with Javascripts framework or if you want to customize a drag and drop feature its possible by calling the  DirectUpload class. Direct upload Javascript events allow progress indication while the file upload.

Since Active Storage is a fairly new library its code base is easier to navigate and explore for the curious among us. 


